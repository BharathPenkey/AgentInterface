<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; connect-src 'self' https://ig.gov-cloud.ai;">
  <title>Chatbot ai</title>
  <link rel="stylesheet" href="./styles.css">
  <script src="./prompt.js" defer></script>
  <script src="./chatBot.js" defer></script>
</head>
<body>
  <div class="mainContainer">
    <div class="leftContainer">
      <dropdown-component></dropdown-component>
      <div id="sessionList">
        <!-- This div will be populated dynamically using JavaScript -->
      </div>
    </div>
    <div class="middleContainer">
      <file-chat-bot></file-chat-bot>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const dropdown = document.querySelector("dropdown-component");
      const sessionList = document.getElementById("sessionList");
      const chatBot = document.querySelector("file-chat-bot");

      dropdown.addEventListener("sessionsFetched", (event) => {
        const { agentId, sessions } = event.detail;
        console.log("Received sessions for Agent:", agentId, sessions);

        // Clear existing session list
        sessionList.innerHTML = "";

        if (!sessions || sessions.length === 0) {
          // Display a "No session IDs available" message if sessions array is empty
          const noSessionsMessage = document.createElement("div");
          noSessionsMessage.className = "no-sessions-message";
          noSessionsMessage.textContent = "No session IDs available.";
          sessionList.appendChild(noSessionsMessage);
        } else {
          // Render session divs
          sessions.forEach((session) => {
            // const title =document.createElement("div");
            // title.className = "title-div";
            // title.textContent = "Session-IDS"
            // title.appendChild(title)
            const sessionDiv = document.createElement("div");
            sessionDiv.className = "session-div";
            sessionDiv.dataset.sessionId = session.id;
            sessionDiv.textContent = session.name;
            sessionList.appendChild(sessionDiv);
          });
        }
      });

      sessionList.addEventListener("click", (event) => {
        const sessionDiv = event.target.closest(".session-div");
        if (sessionDiv) {
          const sessionId = sessionDiv.dataset.sessionId;
          const agentId = dropdown.shadowRoot.getElementById("agentDropdown").value;

          console.log("Selected Session ID:", sessionId);
          console.log("Associated Agent ID:", agentId);

          // Remove 'selected' class from all session divs
          const allSessionDivs = sessionList.querySelectorAll(".session-div");
          allSessionDivs.forEach((div) => div.classList.remove("selected"));

          // Add 'selected' class to the clicked session div
          sessionDiv.classList.add("selected");

          if (chatBot) {
            chatBot.setAgentSession(agentId, sessionId);
          }
        }
      });
    });
  </script>
</body>
</html>
